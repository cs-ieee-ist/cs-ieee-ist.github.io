!function(a){"use strict";var e,t;a.Ghostbin={formatDuration:function(e){return(e|=0)<60?e+"s":e<3600?(e/60|0)+"m"+(e%60|0)+"s":(e/3600|0)+"h"+(e%3600/60|0)+"m"+(e%60|0)+"s"},loadLanguages:function(){var a={more:!1,results:[]},o={};$.ajax({url:"/languages.json",async:!1,dataType:"json",cache:!0,success:function(e){$.each(e,function(e,t){var n=t;n.text=t.name,n.children=t.languages,$.each(t.languages,function(e,n){n.text=n.name,(o[n.id]=n).alt_ids&&$.each(n.alt_ids,function(e,t){o[t]=n})}),a.results.push(n)})}}),t=o,e=a},languagesForSelect2:function(){return e},languageNamed:function(e){if(void 0!==e)return t[e]},defaultLanguage:function(){return this.languageNamed(this.getPreference("defaultLanguage"))},setDefaultLanguage:function(e){this.setPreference("defaultLanguage",e.id)},clearDefaultLanguage:function(){this.clearPreference("defaultLanguage")},defaultExpiration:function(){return this.getPreference("defaultExpiration","-1")},setDefaultExpiration:function(e){this.setPreference("defaultExpiration",e)},clearDefaultExpiration:function(){this.clearPreference("defaultExpiration")},setPreference:function(e,t){localStorage[e]=t},getPreference:function(e,t){return localStorage[e]||t},clearPreference:function(e){delete localStorage[e]},updatePartial:function(t){$.ajax({type:"GET",url:"/partial/"+t,async:!1,dataType:"html",success:function(e){$("#partial_container_"+t).html(e)}})},shouldRefreshPageOnLogin:function(){return 0<(a.location.pathname.match(/session/)||[]).length},refreshPage:function(){a.location=a.location},_loginReplyHandler:function(e){switch($("#partial_container_login_logout .blocker").fadeOut("fast"),e.status){case"valid":$("#login_error").text("").hide(400),Ghostbin.shouldRefreshPageOnLogin()?Ghostbin.refreshPage():(Ghostbin.updatePartial("login_logout"),Ghostbin.displayFlash({type:"success",body:"Successfully logged in."}));break;case"moreinfo":$("#login_error").text("").hide(400),void 0!==e.invalid_fields&&$.each(e.invalid_fields,function(e,t){var n=$("form#loginForm input[name="+t+"]");n.parents(".control-group").eq(0).show(400),n.focus()}),void 0!==e.reason&&$("#login_moreinfo").text(e.reason).show(400);break;case"invalid":void 0!==e.invalid_fields&&$.each(e.invalid_fields,function(e,t){$("form#loginForm input[name="+t+"]").parents(".control-group").eq(0).addClass("error")}),void 0!==e.reason&&$("#login_error").text(e.reason).show(400)}},login:function(e){$("#partial_container_login_logout .blocker").fadeIn("fast"),$("form#loginForm .control-group").removeClass("error"),$.ajax({type:"POST",url:"/auth/login",async:!0,dataType:"json",data:e,success:Ghostbin._loginReplyHandler,error:function(){$("#partial_container_login_logout .blocker").fadeOut("fast")}})},logout:function(){$("#partial_container_login_logout .blocker").fadeIn("fast"),$.ajax({type:"POST",url:"/auth/logout",async:!0,success:function(){$("#partial_container_login_logout .blocker").fadeOut("fast"),Ghostbin.shouldRefreshPageOnLogin()?Ghostbin.refreshPage():(Ghostbin.updatePartial("login_logout"),Ghostbin.displayFlash({type:"success",body:"Successfully logged out."}))},failure:function(e){$("#partial_container_login_logout .blocker").fadeOut("fast"),alert(e)}})},displayFlash:function(e){var t=$("#flash-container"),n=t.find("#flash-template").clone();n.removeAttr("id").find("p").text(e.body),e.type&&n.addClass("well-"+e.type),t.append(n),t.show(),a.setTimeout(function(){n.fadeIn(200),a.setTimeout(function(){n.fadeOut(400,function(){t.hide(),n.remove()})},4e3)},500)}}}(window),$(function(){"use strict";var e,o=$("#pasteForm"),t=$("#code"),i=$("#code-editor");if(0<o.length){var n=o.find("#langbox"),a=o.data("context");Ghostbin.loadLanguages(),n.select2({data:Ghostbin.languagesForSelect2(),matcher:function(e,t,n){if(!n.id)return!1;if(0<=n.name.toUpperCase().indexOf((""+e).toUpperCase()))return!0;if(0<=n.id.toUpperCase().indexOf((""+e).toUpperCase()))return!0;for(var a in n.alt_ids)if(0<=n.alt_ids[a].toUpperCase().indexOf((""+e).toUpperCase()))return!0;return!1}});var l=Ghostbin.languageNamed(n.data("selected"))||Ghostbin.defaultLanguage()||Ghostbin.languageNamed("text");if(n.select2("data",l),"new"===a){o.find("input[name='expire']").val(Ghostbin.defaultExpiration());var r=$("#optionsModal");r.modal({show:!1}),r.find("input[type='checkbox']").on("change",function(){Ghostbin.setPreference($(this).data("gb-key"),this.checked?"true":"false")}).each(function(){this.checked="true"===Ghostbin.getPreference($(this).data("gb-key"),"false")}),$("#optionsButton").on("click",function(){r.modal("show")})}o.on("submit",function(){if(0===(i.val().match(/[^\s]/)||[]).length)return $("#deleteModal, #emptyPasteModal").modal("show"),!1;"new"===a&&("true"===Ghostbin.getPreference("saveExpiration","false")?Ghostbin.setDefaultExpiration(o.find("input[name='expire']").val()):Ghostbin.clearDefaultExpiration(),"true"===Ghostbin.getPreference("saveLanguage","false")?Ghostbin.setDefaultLanguage(n.select2("data")):Ghostbin.clearDefaultLanguage()),o.find("input[name='title']").val($("#editable-paste-title").text())}),$("#editable-paste-title").keypress(function(e){return 13!=e.which||($(i).focus(),!1)})}0!==(e=$("#paste-controls")).length&&e.onMediaQueryChanged("screen and (max-width: 767px)",function(e){this.detach(),(e.matches?$("#phone-paste-control-container"):$("#desktop-paste-control-container")).prepend(this)}),function(){var t=$("#encryptModal");if(0!==t.length){t.modal({show:!1});var n=t.find("input[type='password']"),a=o.find("input[name='password']");n.keypress(function(e){if(13===e.which)return t.modal("hide"),!1});t.on("show",function(){n.val(a.val())}).on("shown",function(){$(this).find("input").eq(0).focus().select()}).on("hidden",function(){var e;a.val(n.val()),e=0<$(this).find("input").val().length,$("#encryptionIcon").removeClass("icon-lock icon-lock-open-alt").addClass(e?"icon-lock":"icon-lock-open-alt"),$("#encryptionButton .button-data-label").text(e?"On":"")}),$("#encryptionButton").on("click",function(){t.modal("show")})}}(),function(){var e=$("#expireModal");if(0!==e.length){e.modal({show:!1});var t=o.find("input[name='expire']"),n=$("#expirationButton .button-data-label"),a=function(){$(this).button("toggle"),t.val($(this).data("value")),n.text($(this).data("display-value"))};a.call(e.find("button[data-value='"+t.val()+"']")),e.find("button[data-value]").on("click",function(){a.call(this),e.modal("hide")}),$("#expirationButton").on("click",function(){e.modal("show")})}}();var s=$("#line-numbers");!function(){if(0!==s.length)if(0<t.length){var e=$(document.createElement("div")).addClass("line-highlight-bar").hide().appendTo("body"),n=e.clone().addClass("line-highlight-bar-permanent").appendTo("body"),a=function(e){e.css("left",s.outerWidth()).css("top",$(this).position().top+$(this).parent().position().top).width(t.outerWidth()).show()},o=function(e){void 0!==e?(n.data("cur-line",e),history.replaceState({line:e},"","#L"+e)):(n.removeData("cur-line"),history.replaceState(null,"","#"))};s.fillWithLineNumbers((t.text().match(/\n/g)||[]).length+1,function(){s.children().mouseenter(function(){a.call(this,e)}).mouseleave(function(){e.hide()}).click(function(){var e=$(this).text();if(0+n.data("cur-line")===e)return o(void 0),void n.hide();o(e),a.call(this,n)}),$(window).on("load popstate",function(){var e=function(e){if(e){var t=e.match(/^#L(\d+)/);return void 0!==t&&0<t.length?t[1]:void 0}}(window.location.hash);if(e){var t=$("span:nth-child("+e+")",s);0<t.length&&(o(e),a.call(t.get(0),n),t.scrollMinimal())}})}),$(window).on("resize",function(){$(e).width(t.outerWidth()),$(n).width(t.outerWidth())}),$(document).on("media-query-changed",function(){a.call($("span:nth-child("+n.data("cur-line")+")",s).get(0),n)})}else 0<i.length&&(i.on("input propertychange",function(){s.fillWithLineNumbers((i.val().match(/\n/g)||[]).length+1,function(){$(".textarea-height-wrapper").css("left",s.outerWidth())})}).triggerHandler("input"),$(document).on("media-query-changed",function(){i.triggerHandler("input")}))}(),function(){if(0<i.length){i.keydown(function(e){if(9===e.keyCode&&!e.ctrlKey&&!e.altKey&&!e.shiftKey){var t=[this.selectionStart,this.selectionEnd];return this.value=this.value.substring(0,t[0])+"\t"+this.value.substring(t[1],this.value.length),this.selectionStart=this.selectionEnd=t[0]+1,!1}if(83===e.keyCode&&e.ctrlKey&&!e.altKey&&!e.shiftKey)return o.submit(),!1});var n=!1;i.on("input propertychange",function(){n=!0}),o.on("submit",function(){n=!1}),$("[name='deleteForm']").on("submit",function(){n=!1}),window.addEventListener("beforeunload",function(e){if(n){var t="If you leave now, your paste will not be saved.";return(e||window.event).returnValue=t}})}}(),$("[autofocus]:not(:focus)").eq(0).focus(),$("[title]").tooltip({trigger:"hover",placement:"bottom",container:"body",delay:{show:250,hide:50}});var u=Math.floor((new Date).getTime()/1e3);$("#expirationIcon").tooltip({trigger:"hover",placement:"bottom",container:"body",title:function(){var e=0+$(this).data("reftime"),t=Math.floor((new Date).getTime()/1e3),n=u-e,a=0+$(this).data("value")+n-t;return 0<a?"Expires in "+window.Ghostbin.formatDuration(a):Math.random()<=.5?"Wha-! It's going to explode! Get out while you still can!":"He's dead, Jim."},delay:{show:250,hide:50}})}),$(function(){if(docCookies.hasItem("flash")){var e=JSON.parse(atob(docCookies.getItem("flash")));docCookies.removeItem("flash","/"),Ghostbin.displayFlash(e)}});